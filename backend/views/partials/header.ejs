<!-- views/partials/header.ejs -->
<style>
  :root{
    --m1:#4f3b8c; --m2:#8363d0; --m3:#7446b6; --m4:#4e2182; --m5:#450c6e;
  }
  .pos-header{
    background: linear-gradient(135deg, rgba(255,255,255,.85), rgba(255,255,255,.70));
    border-radius: 18px;
    padding: 16px 20px;
    backdrop-filter: blur(8px);
    box-shadow: 0 10px 30px rgba(0,0,0,.15);
    position: relative;
    overflow: hidden;
  }
  .pos-header::before{
    content:"";
    position:absolute; inset:0;
    background: radial-gradient(600px 120px at -8% 0%, rgba(116,70,182,.12), transparent 60%),
                radial-gradient(600px 120px at 108% 100%, rgba(131,99,208,.12), transparent 60%);
    pointer-events:none;
  }
  .brand-pill{
    width:48px; height:48px; border-radius:12px;
    background: linear-gradient(135deg, var(--m3), var(--m2));
    display:grid; place-items:center; color:#fff; font-size:22px;
    box-shadow: 0 6px 16px rgba(116,70,182,.35);
  }
  .title-wrap .title{ color: var(--m4); font-weight: 800; letter-spacing:.3px; margin:0; }
  .title-wrap .subtitle{ color:#4e2182cc; font-size:.85rem; }

  .btn-chip{
    --bg: #f3ecff; --bd: rgba(116,70,182,.25); --tx: #4e2182;
    background: var(--bg);
    border: 1px solid var(--bd);
    color: var(--tx);
    border-radius: 999px;
    padding: .45rem .85rem;
    font-weight: 600;
    transition: transform .12s ease, box-shadow .18s ease, background .2s ease;
    text-decoration: none;
    display: inline-flex; align-items: center; gap:.4rem;
  }
  .btn-chip:hover{ transform: translateY(-1px); box-shadow: 0 6px 14px rgba(116,70,182,.18); }

  .btn-chip.primary{ background: linear-gradient(135deg, var(--m3), var(--m2)); border: none; color: #fff; }
  .btn-chip.danger{ background: linear-gradient(135deg, #e05260, #f77f7f); border: none; color: #fff; }
  .btn-chip.soft{ background:#efe7ff; color: var(--m4); border: 1px solid rgba(116,70,182,.25); }

  .btn-pending{
    position: relative; padding-left: 2.1rem;
    background: linear-gradient(135deg, #ffd7a3, #ffc078);
    border: none; color:#5b3200;
  }
  .btn-pending .dot{
    position:absolute; left:.9rem; top:50%; transform:translateY(-50%);
    width:10px; height:10px; border-radius:50%;
    background:#ff6b00; box-shadow: 0 0 0 0 rgba(255,107,0,.5);
    animation: ping 1.6s infinite;
  }
  .btn-pending .count{
    background:#5b3200; color:#fff; font-size:.72rem; line-height:1; padding:.18rem .45rem;
    border-radius:999px; margin-left:.35rem;
  }
  @keyframes ping{
    0%{ box-shadow: 0 0 0 0 rgba(255,107,0,.5); }
    70%{ box-shadow: 0 0 0 10px rgba(255,107,0,0); }
    100%{ box-shadow: 0 0 0 0 rgba(255,107,0,0); }
  }

  .user-chip{
    display:flex; align-items:center; gap:.6rem; padding:.35rem .6rem; border-radius:14px;
    background:#f7f3ff; border:1px solid rgba(116,70,182,.2);
  }
  .avatar{
    width:42px; height:42px; border-radius:50%; object-fit:cover;
    border:2px solid var(--m3); background:#e8defe; display:grid; place-items:center; color:#6d41ad;
    font-weight:800;
  }
  .role-badge{
    display:inline-block; padding:.15rem .5rem; border-radius:999px;
    background: linear-gradient(135deg, var(--m2), var(--m3)); color:#fff; font-size:.7rem;
  }
</style>

<%
  // ===== Mostrar/Ocultar "Volver" =====
  // Oculta solo en /admin (soporta /admin, /admin/, /admin?x=y)
  const current = (typeof currentUrl === 'string') ? currentUrl : '';
  const hideOnAdmin = /^\/admin(?:\/|\?|$)/.test(current);
  const backShow = !hideOnAdmin;

  // Contador de pendientes (inyectado por middleware global)
  const pend = Number(typeof pendingCount !== 'undefined' ? pendingCount : 0) || 0;
%>

<div class="pos-header mb-4">
  <div class="d-flex flex-wrap align-items-center justify-content-between gap-3">
    <!-- IZQUIERDA: Marca -->
    <div class="d-flex align-items-center gap-3">
      <div class="brand-pill">üíº</div>
      <div class="title-wrap">
        <h1 class="title h4">Punto de Venta</h1>
        <div class="subtitle">R√°pido, claro y bonito</div>
      </div>
    </div>

    <!-- CENTRO: Acciones -->
    <div class="d-flex flex-wrap align-items-center gap-2">
      <% if (user && user.role === 'administrador') { %>
        <a href="/users" class="btn-chip">üë• Usuarios</a>
        <a href="/config" class="btn-chip">‚öôÔ∏è Configuraci√≥n</a>
        <a href="/dashboard" class="btn-chip">üìä Dashboard</a>
      <% } %>

      <% if (user) { %>
        <a href="/cart/pendientes" class="btn-chip btn-pending">
          <span class="dot"></span> üïí Tickets pendientes
          <% if (pend > 0) { %><span class="count"><%= pend %></span><% } %>
        </a>
      <% } %>
    </div>

    <!-- DERECHA: Usuario + acciones -->
    <div class="d-flex align-items-center gap-2">
      <% if (user) { %>
        <div class="user-chip">
          <% if (user.image) { %>
            <img src="/uploads/<%= user.image %>" alt="img" class="avatar">
          <% } else { %>
            <div class="avatar"><span>üë§</span></div>
          <% } %>
          <div class="d-flex flex-column">
            <span class="fw-semibold" style="line-height:1"><%= user.name %></span>
            <span class="role-badge text-uppercase"><%= user.role %></span>
          </div>
        </div>

        <% if (backShow) { %>
          <!-- Volver contextual: admin -> /admin, otros -> /cart/view -->
          <a id="btnBack" href="<%= (user.role === 'administrador') ? '/admin' : '/cart/view' %>" class="btn-chip soft">‚¨Ö Volver</a>
        <% } %>

        <a href="/users/logout" class="btn-chip danger">üö™ Cerrar sesi√≥n</a>
      <% } %>
    </div>
  </div>
</div>

<hr class="mb-4">

<!-- Script global type-to-search -->
<script src="/js/type-to-search.js"></script>

<!-- Fallback por si no pasaste currentUrl desde el servidor -->
<script>
  (function () {
    try {
      var path = location && location.pathname ? location.pathname : '';
      if (/^\/admin(?:\/|$)/.test(path)) {
        var btn = document.getElementById('btnBack');
        if (btn) btn.style.display = 'none';
      }
    } catch (e) {}
  })();
</script>
